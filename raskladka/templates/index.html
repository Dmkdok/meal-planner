<!-- raskladka/templates/index.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="current-plan-id" content="{{ selected_plan.id }}">
    <title>–†–∞—Å–∫–ª–∞–¥–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ - {{ selected_plan.name }}</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><circle cx='16' cy='16' r='15' fill='%23e3f2fd' stroke='%23667eea' stroke-width='1'/><circle cx='12' cy='14' r='3' fill='%23ff6b6b'/><path d='M16 8c-2 0-4 1-5 3-1 2-1 4 0 6 1 2 3 3 5 3s4-1 5-3c1-2 1-4 0-6-1-2-3-3-5-3z' fill='%23ff6b6b'/><text x='16' y='22' text-anchor='middle' fill='%23667eea' font-family='Arial' font-size='8' font-weight='bold'>–†–ü</text></svg>">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="app-wrapper">
        <!-- Header —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo-section">
                    <h1 class="app-title">–†–∞—Å–∫–ª–∞–¥–∫–∞ –ü—Ä–æ–¥—É–∫—Ç–æ–≤</h1>
                    <p class="app-subtitle">–°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∏—Ç–∞–Ω–∏—è</p>
                </div>
                <nav class="main-nav">
                    <div class="nav-tabs">
                        <button class="nav-tab active" data-tab="layout">
                            <span class="tab-icon">üìã</span>
                            –†–∞—Å–∫–ª–∞–¥–∫–∞
                        </button>
                        <button class="nav-tab" data-tab="calculator">
                            <span class="tab-icon">üßÆ</span>
                            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
                        </button>
                    </div>
                </nav>
                <div class="user-section">
                    <div class="auth-links">
                        <a href="{{ url_for('views.logout') }}" class="logout-btn">
                            <span class="btn-icon">üö™</span>
                            –í—ã–π—Ç–∏
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <div class="app-container">
        <div class="main-container">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="sidebar">
            <h3>–í–∞—à–∏ —Ä–∞—Å–∫–ª–∞–¥–∫–∏</h3>
            <ul class="plan-list">
                {% for plan in meal_plans %}
                <li class="{% if plan.id == selected_plan.id %}selected-plan{% endif %}"
                    onclick="selectPlan({{ plan.id }})">
                    {{ plan.name }}
                    <div style="font-size: 0.8em; opacity: 0.8; margin-top: 4px;">
                        {{ plan.created_at.strftime('%Y-%m-%d') }}
                    </div>
                </li>
                {% endfor %}
            </ul>

            <div class="create-plan-section">
                <input type="text" id="new-plan-name" class="new-plan-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ä–∞—Å–∫–ª–∞–¥–∫–∏">
                <button class="create-plan-btn">+ –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å–∫–ª–∞–¥–∫—É</button>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤–∫–ª–∞–¥–æ–∫ -->
        <div class="tab-content">
            <!-- –í–∫–ª–∞–¥–∫–∞ "–†–∞—Å–∫–ª–∞–¥–∫–∞" -->
            <div id="layout-tab" class="tab-pane active">
                <div class="main-content">
            <div class="content-header">
                <div class="plan-title-section">
                    <h1 class="plan-title" data-original-name="{{ selected_plan.name }}">
                        {{ selected_plan.name }}
                    </h1>
                    <input type="text" class="plan-title-input" id="plan-name-input" value="{{ selected_plan.name }}" style="display: none;">
                </div>

                <div class="header-actions">
                    <button class="delete-plan-btn">
                        –£–¥–∞–ª–∏—Ç—å —Ä–∞—Å–∫–ª–∞–¥–∫—É
                    </button>
                </div>
            </div>

            <!-- –î–Ω–∏ -->
            <div class="days-grid">
            {% for day in selected_plan.days %}
            <div class="day-container" data-day="{{ day.day_number }}">
                <div class="day-header">
                    <h2>–†–∞—Ü–∏–æ–Ω {{ day.day_number }}</h2>
                    <a href="{{ url_for('views.edit_day', day_id=day.id) }}" class="edit-day-btn">
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>
                </div>

                <div class="day-content">
                    {% for meal in day.meals %}
                    <div class="meal" data-meal-id="{{ meal.id }}">
                        <div class="meal-header">
                            <div class="meal-title">{{ meal.meal_type }}</div>
                        </div>

                        <div class="product-list">
                            {% for product in meal.products %}
                            <div class="product-item" data-product-id="{{ product.id }}" data-product-name="{{ product.name }}" data-product-weight="{{ product.weight }}">
                                <div class="product-info">
                                    <div class="product-display">
                                        {{ product.name }} - {{ product.weight }}–≥
                                    </div>
                                    <div class="product-edit-form">
                                        <input type="text" class="edit-input" data-type="name" value="{{ product.name }}">
                                        <input type="number" class="edit-input" data-type="weight" value="{{ product.weight }}">
                                        <button class="save-product-btn" onclick="saveProductEdit({{ product.id }})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                        <button class="cancel-edit-btn" onclick="cancelProductEdit({{ product.id }})">–û—Ç–º–µ–Ω–∞</button>
                                    </div>
                                </div>
                                <div class="product-actions">
                                    <button class="edit-product-btn" onclick="startEditProduct({{ product.id }})">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                                    <button class="delete-product-btn" onclick="deleteProduct({{ product.id }})">–£–¥–∞–ª–∏—Ç—å</button>
                                </div>
                            </div>
                            {% endfor %}
                            
                            <div class="add-product-form">
                                <div class="form-row">
                                    <input type="text" class="product-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞">
                                    <input type="number" class="product-weight" placeholder="–í–µ—Å (–≥)">
                                    <button class="add-product-btn" onclick="addProduct({{ day.day_number }}, {{ meal.id }})">–î–æ–±–∞–≤–∏—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}

                    <button class="add-meal-btn" onclick="addMeal({{ day.day_number }})">
                        + –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–µ–º –ø–∏—â–∏
                    </button>
                </div>
            </div>
            {% endfor %}
            </div>

            <button class="add-day-btn">
                + –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–∞—Ü–∏–æ–Ω
            </button>
        </div>
    </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä" -->
            <div id="calculator-tab" class="tab-pane">
                <div class="calculator-content">
                    <div class="calculator-header">
                        <h2>üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h2>
                        <p>–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è –≤–∞—à–µ–π —Ä–∞—Å–∫–ª–∞–¥–∫–∏</p>
                    </div>

                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
                    <div class="main-results-section" id="main-results-section" style="display: none;">
                        <h3>üìã –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h3>
                        <div class="main-results-content" id="main-results-content">
                            <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
                        </div>
                    </div>

                    <div class="calculator-grid">
                        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞—Å–∫–ª–∞–¥–∫–µ -->
                        <div class="calculator-panel">
                            <h3>üìã –¢–µ–∫—É—â–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞</h3>
                            <div class="layout-info">
                                <div class="layout-summary">
                                    <h4>üìä {{ selected_plan.name }}</h4>
                                    <p><strong>–†–∞—Ü–∏–æ–Ω–æ–≤ –≤ —Ä–∞—Å–∫–ª–∞–¥–∫–µ:</strong> {{ selected_plan.days|length }}</p>
                                    <p><strong>–í—Å–µ–≥–æ –ø—Ä–∏–µ–º–æ–≤ –ø–∏—â–∏:</strong>
                                        {% set total_meals = 0 %}
                                        {% for day in selected_plan.days %}
                                            {% for meal in day.meals %}
                                                {% set total_meals = total_meals + 1 %}
                                            {% endfor %}
                                        {% endfor %}
                                        {{ total_meals }}
                                    </p>
                                    <p><strong>–í—Å–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤:</strong>
                                        {% set total_products = 0 %}
                                        {% for day in selected_plan.days %}
                                            {% for meal in day.meals %}
                                                {% set total_products = total_products + meal.products|length %}
                                            {% endfor %}
                                        {% endfor %}
                                        {{ total_products }}
                                    </p>
                                </div>

                                <div class="layout-details">
                                    <h4>üìÖ –î–µ—Ç–∞–ª–∏ –ø–æ —Ä–∞—Ü–∏–æ–Ω–∞–º:</h4>
                                    {% for day in selected_plan.days %}
                                    <div class="day-summary">
                                        <h5>–†–∞—Ü–∏–æ–Ω {{ day.day_number }}</h5>
                                        <div class="meals-summary">
                                            {% for meal in day.meals %}
                                            <div class="meal-summary">
                                                <span class="meal-type">{{ meal.meal_type }}</span>
                                                <span class="products-count">
                                                    {{ meal.products|length }} –ø—Ä–æ–¥—É–∫—Ç–æ–≤
                                                </span>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –†–∞—Å—á–µ—Ç—ã -->
                        <div class="calculator-panel">
                            <h3>üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á–µ—Ç–∞</h3>
                            <div class="calculation-settings">
                                <div class="setting-group">
                                    <label for="trip-days">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ—Ö–æ–¥–∞ (–¥–Ω–µ–π):</label>
                                    <input type="number" id="trip-days" value="{{ selected_plan.days|length }}" min="1" max="30">
                                </div>
                                <div class="setting-group">
                                    <label for="people-count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–ª–æ–≤–µ–∫:</label>
                                    <input type="number" id="people-count" value="1" min="1" max="10">
                                </div>
                            </div>

                            <div class="calculation-info">
                                <div class="info-box">
                                    <h4>‚ÑπÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–∞—Å—á–µ—Ç:</h4>
                                    <ul>
                                        <li>–°–∏—Å—Ç–µ–º–∞ –±–µ—Ä–µ—Ç –ø—Ä–æ–¥—É–∫—Ç—ã –∏–∑ –≤–∞—à–µ–π —Ä–∞—Å–∫–ª–∞–¥–∫–∏</li>
                                        <li>–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–∞–∂–¥–æ–º —Ä–∞—Ü–∏–æ–Ω–µ (–¥–Ω–µ —Ä–∞—Å–∫–ª–∞–¥–∫–∏)</li>
                                        <li>–°—É–º–º–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –∑–∞ –≤–µ—Å—å –ø–æ—Ö–æ–¥</li>
                                        <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–ª–æ–≤–µ–∫</li>
                                        <li>–û–±—â–∏–π –≤–µ—Å = –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π √ó –í–µ—Å –∑–∞ 1 –ø—Ä–∏–µ–º –Ω–∞ –≤—Å–µ—Ö —á–µ–ª–æ–≤–µ–∫</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="calculate-section">
                                <button class="calculate-btn">
                                    üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞—Å–∫–ª–∞–¥–∫–∏
                                </button>
                            </div>

                            <div class="results-section" id="results-section" style="display: none;">
                                <h4>üìä –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞</h4>
                                <div class="results-content" id="results-content">
                                    <!-- –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // –ü–µ—Ä–µ–¥–∞–µ–º ID —Ç–µ–∫—É—â–µ–≥–æ –ø–ª–∞–Ω–∞ –≤ JavaScript
        window.currentPlanId = {{ selected_plan.id }};
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>